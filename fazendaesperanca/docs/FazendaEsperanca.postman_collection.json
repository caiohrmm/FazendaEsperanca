{
  "info": {
    "name": "Fazenda Esperança API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Coleção para testar a API da Fazenda Esperança. Use o ambiente 'FazendaEsperanca Local'. Após /auth/login, o token é salvo automaticamente e herdado por todas as requisições."
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      { "key": "token", "value": "{{accessToken}}", "type": "string" }
    ]
  },
  "item": [
    {
      "name": "Auth",
      "description": "Cadastro, login e refresh de tokens",
      "item": [
        {
          "name": "Register (ADMIN)",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/auth/register", "host": ["{{baseUrl}}"], "path": ["auth","register"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nome\": \"Admin Local\",\n  \"email\": \"admin@fazenda.org\",\n  \"senha\": \"Admin@123\",\n  \"role\": \"ADMIN\"\n}"
            },
            "auth": { "type": "noauth" }
          },
          "response": []
        },
        {
          "name": "Login",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/auth/login", "host": ["{{baseUrl}}"], "path": ["auth","login"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"senha\": \"{{adminPassword}}\"\n}"
            },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('200 OK', function () { pm.response.to.have.status(200); });",
                  "const json = pm.response.json();",
                  "pm.environment.set('accessToken', json.accessToken);",
                  "pm.environment.set('refreshToken', json.refreshToken);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        },
        {
          "name": "Refresh",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/auth/refresh", "host": ["{{baseUrl}}"], "path": ["auth","refresh"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('200 OK', function () { pm.response.to.have.status(200); });",
                  "const json = pm.response.json();",
                  "pm.environment.set('accessToken', json.accessToken);",
                  "pm.environment.set('refreshToken', json.refreshToken);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "response": []
        }
      ]
    },
    {
      "name": "Acolhidas",
      "item": [
        {
          "name": "Criar Acolhida",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/acolhidas", "host": ["{{baseUrl}}"], "path": ["acolhidas"] },
            "body": { "mode": "raw", "raw": "{\n  \"nomeCompleto\": \"Maria da Silva\",\n  \"dataNascimento\": \"1995-05-10\",\n  \"dataEntrada\": \"2024-01-15\",\n  \"documento\": \"12345678900\",\n  \"telefone\": \"11999999999\",\n  \"status\": \"ATIVA\",\n  \"fotoUrl\": null,\n  \"observacoes\": \"Observação inicial\"\n}" }
          },
          "event": [{"listen":"test","script":{"type":"text/javascript","exec":["pm.test('201/200', function(){ pm.expect([200,201]).to.include(pm.response.code); });","pm.environment.set('acolhidaId', pm.response.json().id); "]}}]
        },
        {
          "name": "Listar Acolhidas",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/acolhidas?page=0&size=10&sort=id,desc",
              "host": ["{{baseUrl}}"],
              "path": ["acolhidas"],
              "query": [
                {"key":"page","value":"0"},
                {"key":"size","value":"10"},
                {"key":"sort","value":"id,desc"}
              ]
            }
          }
        },
        {
          "name": "Obter Acolhida",
          "request": { "method": "GET", "url": { "raw": "{{baseUrl}}/acolhidas/{{acolhidaId}}", "host":["{{baseUrl}}"], "path":["acolhidas","{{acolhidaId}}"] } }
        },
        {
          "name": "Atualizar Acolhida",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/acolhidas/{{acolhidaId}}", "host": ["{{baseUrl}}"], "path": ["acolhidas","{{acolhidaId}}"] },
            "body": { "mode": "raw", "raw": "{\n  \"nomeCompleto\": \"Maria da Silva\",\n  \"dataNascimento\": \"1995-05-10\",\n  \"dataEntrada\": \"2024-01-15\",\n  \"documento\": \"12345678900\",\n  \"telefone\": \"11999999999\",\n  \"status\": \"ATIVA\",\n  \"fotoUrl\": null,\n  \"observacoes\": \"Observação atualizada\"\n}" }
          }
        },
        {
          "name": "Excluir Acolhida (ADMIN)",
          "request": { "method": "DELETE", "url": { "raw": "{{baseUrl}}/acolhidas/{{acolhidaId}}", "host": ["{{baseUrl}}"], "path": ["acolhidas","{{acolhidaId}}"] } }
        }
      ]
    },
    {
      "name": "Saídas Médicas",
      "item": [
        {
          "name": "Criar Saída",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/saidas-medicas", "host": ["{{baseUrl}}"], "path": ["saidas-medicas"] },
            "body": { "mode": "raw", "raw": "{\n  \"acolhidaId\": {{acolhidaId}},\n  \"motivo\": \"CONSULTA\",\n  \"destino\": \"Hospital Municipal\",\n  \"profissional\": \"Dra. Ana\",\n  \"dataHoraSaida\": \"{{nowUtc}}\",\n  \"meioTransporte\": \"Carro\",\n  \"observacoes\": \"Levar resultados\",\n  \"responsavel\": \"ALCILEIA_FIGUEREDO\"\n}" }
          },
          "event": [{"listen":"test","script":{"type":"text/javascript","exec":["pm.environment.set('saidaMedicaId', pm.response.json().id);"]}}]
        },
        {
          "name": "Registrar Retorno",
          "request": {
            "method": "PUT",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/saidas-medicas/{{saidaMedicaId}}/retorno", "host": ["{{baseUrl}}"], "path": ["saidas-medicas","{{saidaMedicaId}}","retorno"] },
            "body": { "mode": "raw", "raw": "{\n  \"dataHoraRetorno\": \"{{nowPlus1hUtc}}\"\n}" }
          }
        },
        {
          "name": "Listar Saídas",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/saidas-medicas?page=0&size=10&sort=id,desc",
              "host": ["{{baseUrl}}"],
              "path": ["saidas-medicas"],
              "query": [ {"key":"page","value":"0"}, {"key":"size","value":"10"}, {"key":"sort","value":"id,desc"} ]
            }
          }
        },
        {
          "name": "Obter Saída",
          "request": { "method": "GET", "url": { "raw": "{{baseUrl}}/saidas-medicas/{{saidaMedicaId}}", "host":["{{baseUrl}}"], "path":["saidas-medicas","{{saidaMedicaId}}"] } }
        },
        {
          "name": "Excluir Saída (ADMIN)",
          "request": { "method": "DELETE", "url": { "raw": "{{baseUrl}}/saidas-medicas/{{saidaMedicaId}}", "path":["saidas-medicas","{{saidaMedicaId}}"], "host":["{{baseUrl}}"] } }
        }
      ]
    },
    {
      "name": "Transações Financeiras",
      "item": [
        {
          "name": "Criar Transação - Doação Externa",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/transacoes", "host": ["{{baseUrl}}"], "path": ["transacoes"] },
            "body": { "mode": "raw", "raw": "{\n  \"tipo\": \"DOACAO_EXTERNA\",\n  \"origemNome\": \"Empresa ABC\",\n  \"origemDocumento\": \"12345678900011\",\n  \"valor\": 500.00,\n  \"formaPagamento\": \"PIX\",\n  \"descricao\": \"Doação institucional\"\n}" }
          },
          "event": [{"listen":"test","script":{"type":"text/javascript","exec":["pm.environment.set('transacaoId', pm.response.json().id);"]}}]
        },
        {
          "name": "Criar Transação - Recebimento Acolhida",
          "request": {
            "method": "POST",
            "header": [ { "key": "Content-Type", "value": "application/json" } ],
            "url": { "raw": "{{baseUrl}}/transacoes", "host": ["{{baseUrl}}"], "path": ["transacoes"] },
            "body": { "mode": "raw", "raw": "{\n  \"tipo\": \"RECEBIMENTO_ACOLHIDA\",\n  \"acolhidaId\": {{acolhidaId}},\n  \"valor\": 120.00,\n  \"formaPagamento\": \"DINHEIRO\",\n  \"descricao\": \"Recebimento da acolhida\"\n}" }
          }
        },
        {
          "name": "Gerar Recibo PDF",
          "request": { "method": "GET", "url": { "raw": "{{baseUrl}}/transacoes/{{transacaoId}}/recibo/pdf", "host":["{{baseUrl}}"], "path":["transacoes","{{transacaoId}}","recibo","pdf"] } }
        },
        {
          "name": "Upload Recibo Assinado",
          "request": {
            "method": "POST",
            "url": { "raw": "{{baseUrl}}/transacoes/{{transacaoId}}/recibo-assinado", "host":["{{baseUrl}}"], "path":["transacoes","{{transacaoId}}","recibo-assinado"] },
            "body": {
              "mode": "formdata",
              "formdata": [ { "key": "file", "type": "file", "src": [] } ]
            }
          }
        },
        {
          "name": "Listar Transações",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/transacoes?page=0&size=10&sort=id,desc",
              "host": ["{{baseUrl}}"],
              "path": ["transacoes"],
              "query": [ {"key":"page","value":"0"}, {"key":"size","value":"10"}, {"key":"sort","value":"id,desc"} ]
            }
          }
        },
        {
          "name": "Obter Transação",
          "request": { "method": "GET", "url": { "raw": "{{baseUrl}}/transacoes/{{transacaoId}}", "host":["{{baseUrl}}"], "path":["transacoes","{{transacaoId}}"] } }
        },
        {
          "name": "Cancelar Transação (ADMIN/RESPONSAVEL)",
          "request": { "method": "POST", "url": { "raw": "{{baseUrl}}/transacoes/{{transacaoId}}/cancelar", "host":["{{baseUrl}}"], "path":["transacoes","{{transacaoId}}","cancelar"] } }
        }
      ]
    },
    {
      "name": "Relatórios & Estatísticas",
      "item": [
        {
          "name": "Relatório Saídas CSV",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/relatorios/saidas-medicas.csv?de={{deIso}}&ate={{ateIso}}",
              "host": ["{{baseUrl}}"],
              "path": ["relatorios","saidas-medicas.csv"],
              "query": [ {"key":"de","value":"{{deIso}}"}, {"key":"ate","value":"{{ateIso}}"} ]
            }
          }
        },
        {
          "name": "Relatório Financeiro CSV",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/relatorios/financeiro.csv?de={{deIso}}&ate={{ateIso}}",
              "host": ["{{baseUrl}}"],
              "path": ["relatorios","financeiro.csv"],
              "query": [ {"key":"de","value":"{{deIso}}"}, {"key":"ate","value":"{{ateIso}}"} ]
            }
          }
        }
      ]
    }
  ],
  "variable": [
    { "key": "nowUtc", "value": "2025-01-01T12:00:00Z" },
    { "key": "nowPlus1hUtc", "value": "2025-01-01T13:00:00Z" },
    { "key": "deIso", "value": "2025-01-01T00:00:00Z" },
    { "key": "ateIso", "value": "2025-12-31T23:59:59Z" }
  ]
}


